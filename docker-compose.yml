version: '3.8'

services:
  dockjob:
    image: matepalocska/dockjob:latest
    container_name: dockjob
    restart: unless-stopped
    ports:
      - "8301:80"
    environment:
      # Required - Replace with your server's IP/hostname and port
      - APIAPP_APIURL=http://localhost:8301/api
      - APIAPP_TRIGGERAPIURL=http://localhost:8301/triggerapi
      - APIAPP_APIDOCSURL=http://localhost:8301/apidocs
      - APIAPP_FRONTENDURL=http://localhost:8301/frontend
      - APIAPP_COMMON_ACCESSCONTROLALLOWORIGIN=http://localhost:8301
      
      # Required - Set a secure password
      - DOCKJOB_EXTERNAL_TRIGGER_SYS_PASSWORD=change-this-password
      
      # Optional - Job execution settings
      - APIAPP_USERFORJOBS=dockjobuser
      - APIAPP_GROUPFORJOBS=dockjobgroup
      
      # Data persistence - Store job data in mounted volume
      - APIAPP_OBJECTSTORECONFIG={"Type":"SimpleFileStore", "BaseLocation": "/data"}
      
    # Health check
    healthcheck:
      test: ["CMD", "/healthcheck.sh"]
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3
    
    # Mount volumes for persistent data
    volumes:
      - ./data:/data
      - ./logs:/var/log/uwsgi
    
  # Optional: Add a reverse proxy like Nginx or Traefik
  # nginx:
  #   image: nginx:alpine
  #   container_name: dockjob-proxy
  #   ports:
  #     - "80:80"
  #   volumes:
  #     - ./nginx.conf:/etc/nginx/nginx.conf:ro
  #   depends_on:
  #     - dockjob